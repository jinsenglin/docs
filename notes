[jinsenglin.121004-NB1-CSSI] > ssh -i bosh.pem -o StrictHostKeyChecking=no vcap@10.5.50.140 #cf haproxy/0
  [4dd5161-c962-48c6-9bfb-4ff8b1d0119e] > ssh -i bosh.pem -o StrictHostKeyChecking=no vcap@192.168.0.113 #cf runner/0
    [344b874c-bc7a-41ab-8dc3-cee5864b49df] > sudo su #c1oudc0w
    [344b874c-bc7a-41ab-8dc3-cee5864b49df] > ifconfig
    [344b874c-bc7a-41ab-8dc3-cee5864b49df] > tcpdump -i w-196gt6dfnmi-0 'host 10.254.0.10' #10 是container ip, 自己是9
    OR
    [344b874c-bc7a-41ab-8dc3-cee5864b49df] > tcpdump -i w-196gt6dfnmi-0 'port 443'
    OR
    [344b874c-bc7a-41ab-8dc3-cee5864b49df] > tcpdump -i any host 52.22.122.48 and port 443
    [344b874c-bc7a-41ab-8dc3-cee5864b49df] > tcpdump -i any host 52.22.122.48 and port 443 -w CF-RUNNER.pcap
    [344b874c-bc7a-41ab-8dc3-cee5864b49df] > tcpdump -i any 'host 52.22.122.48 or host 54.236.116.26' and port 443 -w CF-RUNNER.pivotal.io.any.pcap

[jinsenglin.121004-NB1-CSSI] > ssh -i bosh.pem -o StrictHostKeyChecking=no vcap@10.5.50.140 #cf haproxy/0
  [4dd5161-c962-48c6-9bfb-4ff8b1d0119e] > ssh -i bosh.pem -o StrictHostKeyChecking=no vcap@192.168.0.113 #cf runner/0
    [344b874c-bc7a-41ab-8dc3-cee5864b49df] > sudo su #c1oudc0w
    [344b874c-bc7a-41ab-8dc3-cee5864b49df] > WCP=$(cat /var/vcap/data/dea_next/db/instances.json | jq '.instances[0].warden_container_path' | sed 's/"//g')
    [344b874c-bc7a-41ab-8dc3-cee5864b49df] > /var/vcap/packages/warden/warden/src/wsh/wsh --socket $WCP/run/wshd.sock --user root #app container
      [196gt6dfnmi] > tcpdump -i w-196gt6dfnmi-1 'host 10.254.0.10' #10 是自己 ip
      OR
      [196gt6dfnmi] > tcpdump -i w-196gt6dfnmi-1 'port 443'
      OR
      [196gt6dfnmi] > tcpdump -i any host 52.22.122.48 and port 443
    
[jinsenglin.121004-NB1-CSSI] > ssh -i bosh.pem -o StrictHostKeyChecking=no vcap@10.5.50.140 #cf haproxy/0
  [4dd5161-c962-48c6-9bfb-4ff8b1d0119e] > ssh -i bosh.pem -o StrictHostKeyChecking=no vcap@192.168.0.113 #cf runner/0
    [344b874c-bc7a-41ab-8dc3-cee5864b49df] > sudo su #c1oudc0w
    [344b874c-bc7a-41ab-8dc3-cee5864b49df] > WCP=$(cat /var/vcap/data/dea_next/db/instances.json | jq '.instances[0].warden_container_path' | sed 's/"//g')
    [344b874c-bc7a-41ab-8dc3-cee5864b49df] > /var/vcap/packages/warden/warden/src/wsh/wsh --socket $WCP/run/wshd.sock --user root #app container
      [196gt6dfnmi] > wget https://docs.cloudfoundry.org/devguide/deploy-apps/large-app-deploy.html
      OR
      [196gt6dfnmi] > while true; do wget https://pivotal.io/ --no-check-certificate -T 10; sleep 10; done
      
[jinsenglin.121004-NB1-CSSI] > ssh -i bosh.pem -o StrictHostKeyChecking=no vcap@10.5.50.140 #cf haproxy/0
  [4dd5161-c962-48c6-9bfb-4ff8b1d0119e] > ssh -i bosh.pem -o StrictHostKeyChecking=no vcap@192.168.0.113 #cf runner/0
    [344b874c-bc7a-41ab-8dc3-cee5864b49df] > sudo su #c1oudc0w
    [344b874c-bc7a-41ab-8dc3-cee5864b49df] > WCP=$(cat /var/vcap/data/dea_next/db/instances.json | jq '.instances[0].warden_container_path' | sed 's/"//g')
    [344b874c-bc7a-41ab-8dc3-cee5864b49df] > /var/vcap/packages/warden/warden/src/wsh/wsh --socket $WCP/run/wshd.sock --user root #app container
      [196gt6dfnmi] > traceroute 54.164.213.58 #docs.cloudfoundry.org ip
      
[jinsenglin.121004-NB1-CSSI] > ssh -o StrictHostKeyChecking=no root@10.5.50.6 #openstack controller physical machine (PASS: r00tme)
  [HP-controller] > cat /etc/hosts
  [HP-controller] > tcpdump -i any host 52.22.122.48 and port 443
  RESULT: Captured packets
  [HP-controller] > tcpdump -i any host 52.22.122.48 and port 443 -w HP-controller.pcap
  RESULT: [TCP Retransmission] Server Hello
  [HP-controller] > tcpdump -i any 'host 52.22.122.48 or host 54.236.116.26' and port 443 -w HP-controller.pivotal.io.pcap
  [HP-controller] > tcpdump -i eth3 'host 52.22.122.48 or host 54.236.116.26' and port 443 -w HP-controller.pivotal.io.eth3.pcap
  NOTE: br-ex is a bridge with 4 interfaces (eth3, p_ff798dba-0, v_public, v_vrouter_pub)

[jinsenglin.121004-NB1-CSSI] > ssh -o StrictHostKeyChecking=no root@10.5.50.6 #openstack controller physical machine (PASS: r00tme)
  [HP-controller] > cat /etc/hosts
  [HP-controller] > ssh ASUS-compute
    [ASUS-compute] > tcpdump -i any host 52.22.122.48 and port 443
    RESULT: No captured packets

[jinsenglin.121004-NB1-CSSI] > ssh -o StrictHostKeyChecking=no root@10.5.50.6 #openstack controller physical machine (PASS: r00tme)
  [HP-controller] > cat /etc/hosts
  [HP-controller] > ssh TYAN2-compute
    [TYAN2-compute] > tcpdump -i any host 52.22.122.48 and port 443
    RESULT: No captured packets

[jinsenglin.121004-NB1-CSSI] > ssh -o StrictHostKeyChecking=no root@10.5.50.6 #openstack controller physical machine (PASS: r00tme)
  [HP-controller] > cat /etc/hosts
  [HP-controller] > ssh INWIN-compute
    [INWIN-compute] > tcpdump -i any host 52.22.122.48 and port 443
    RESULT: Captured packets
    [INWIN-compute] > tcpdump -i any host 52.22.122.48 and port 443 -w INWIN-compute.pcap
    RESULT: No Server Hello but [TCP Retransmission] Client Hello
    [INWIN-compute] > tcpdump -i any 'host 52.22.122.48 or host 54.236.116.26' and port 443 -w INWIN-compute.pivotal.io.pcap
    [INWIN-compute] > tcpdump -i qbrbfe96030-f8 'host 52.22.122.48 or host 54.236.116.26' and port 443 -w INWIN-compute.pivotal.io.qbrbfe96030-f8.pcap
    NOTE: qbrbfe96030-f8 is a bridge with two interfaces (qvbbfe96030-f8 and tapbfe96030-f8)
    NOTE: in file /etc/libvirt/qemu/instance-00000062.xml, qbrbfe96030-f8 is the source bridge, tapbfe96030-f8 is the target dev

[jinsenglin.121004-NB1-CSSI] > ssh -o StrictHostKeyChecking=no root@10.5.50.6 #openstack controller physical machine (PASS: r00tme)
  [HP-controller] > cat /etc/hosts
  [HP-controller] > ssh TYAN1-compute
    [TYAN1-compute] > tcpdump -i any host 52.22.122.48 and port 443
    RESULT: No captured packets

RESULT
docs.cloudfoundry.org => 107.23.245.156 OK
docs.cloudfoundry.org => 54.164.213.58 FAIL!

pivotal.io => 52.22.122.48 FAIL!
pivotal.io => 54.236.116.26 OK

download.run.pivotal.io => 54.182.1.96 FAIL!
download.run.pivotal.io => 54.182.2.132 FAIL!
download.run.pivotal.io => 54.182.4.188 OK , FAIL!
download.run.pivotal.io => 54.182.4.205 OK , FAIL!
download.run.pivotal.io => 54.182.4.221 FAIL!
download.run.pivotal.io => 54.182.4.224 FAIL!
download.run.pivotal.io => 54.182.4.229 FAIL!
download.run.pivotal.io => 54.182.5.18 FAIL!

traceroute 54.236.116.26
 1  10.254.0.1 (10.254.0.1)  0.085 ms  0.035 ms  0.016 ms
 2  192.168.0.1 (192.168.0.1)  1.557 ms  1.520 ms  1.484 ms
 3  10.5.0.1 (10.5.0.1)  1.703 ms  1.398 ms  1.339 ms
 4  219-81-19-233.static.tfn.net.tw (219.81.19.233)  1.774 ms  1.901 ms  1.603 ms
 5  60-199-18-141.static.tfn.net.tw (60.199.18.141)  1.782 ms  1.721 ms  1.695 ms
 6  60-199-23-13.static.tfn.net.tw (60.199.23.13)  1.503 ms 60-199-20-50.static.tfn.net.tw (60.199.20.50)  1.065 ms 60-199-20-58.static.tfn.net.tw (60.199.20.58)  1.068 ms
 7  60-199-3-222.static.tfn.net.tw (60.199.3.222)  1.421 ms  1.266 ms  1.196 ms
 8  63-218-244-169.static.pccwglobal.net (63.218.244.169)  2.522 ms persado.ge3-2.9.ar01.ath01.pccwbtn.net (63.218.17.101)  2.582 ms 63-218-244-173.static.pccwglobal.net (63.218.244.173)  2.685 ms
 9  * * *
10  * * *
11  * * *
12  * * *
13  54.240.228.232 (54.240.228.232)  224.719 ms 54.240.228.250 (54.240.228.250)  207.832 ms  207.756 ms
14  54.240.229.189 (54.240.229.189)  226.128 ms 54.240.229.191 (54.240.229.191)  211.288 ms  211.160 ms
15  54.240.229.135 (54.240.229.135)  214.986 ms 54.240.229.129 (54.240.229.129)  222.064 ms 54.240.228.159 (54.240.228.159)  223.802 ms
16  54.239.109.202 (54.239.109.202)  242.947 ms 54.239.109.236 (54.239.109.236)  232.878 ms 54.239.109.64 (54.239.109.64)  291.937 ms
17  54.239.110.33 (54.239.110.33)  216.406 ms 54.239.109.87 (54.239.109.87)  221.404 ms 54.239.109.93 (54.239.109.93)  221.382 ms
18  54.239.109.156 (54.239.109.156)  220.821 ms 54.239.109.126 (54.239.109.126)  233.245 ms 54.239.109.226 (54.239.109.226)  235.974 ms
19  54.239.109.115 (54.239.109.115)  215.670 ms 54.239.111.97 (54.239.111.97)  215.305 ms 54.239.111.109 (54.239.111.109)  206.916 ms
20  205.251.244.231 (205.251.244.231)  211.577 ms 205.251.245.252 (205.251.245.252)  222.946 ms 205.251.244.231 (205.251.244.231)  212.324 ms

traceroute 52.22.122.48
 1  10.254.0.1 (10.254.0.1)  0.155 ms  0.020 ms  0.017 ms
 2  192.168.0.1 (192.168.0.1)  2.001 ms  1.871 ms  1.879 ms
 3  10.5.0.1 (10.5.0.1)  1.770 ms  1.740 ms  2.004 ms
 4  219-81-19-233.static.tfn.net.tw (219.81.19.233)  2.015 ms  1.935 ms  2.211 ms
 5  60-199-18-141.static.tfn.net.tw (60.199.18.141)  1.870 ms  1.836 ms  1.793 ms
 6  60-199-21-26.static.tfn.net.tw (60.199.21.26)  2.070 ms 60-199-3-141.static.tfn.net.tw (60.199.3.141)  1.251 ms 60-199-20-58.static.tfn.net.tw (60.199.20.58)  1.511 ms
 7  60-199-3-222.static.tfn.net.tw (60.199.3.222)  1.384 ms  1.288 ms  1.473 ms
 8  63-218-244-173.static.pccwglobal.net (63.218.244.173)  1.845 ms 63-218-244-169.static.pccwglobal.net (63.218.244.169)  2.355 ms 63-218-17-5.static.pccwglobal.net (63.218.17.5)  2.445 ms
 9  * * *
10  * * *
11  * * *
12  * * *
13  54.240.228.232 (54.240.228.232)  224.314 ms 54.240.228.244 (54.240.228.244)  224.993 ms 54.240.228.232 (54.240.228.232)  224.258 ms
14  54.240.229.191 (54.240.229.191)  211.147 ms 54.240.229.185 (54.240.229.185)  224.199 ms 54.240.229.189 (54.240.229.189)  225.429 ms
15  54.240.228.163 (54.240.228.163)  224.522 ms 54.240.228.175 (54.240.228.175)  206.358 ms 54.240.229.131 (54.240.229.131)  221.639 ms
16  54.239.109.128 (54.239.109.128)  228.111 ms 54.239.109.198 (54.239.109.198)  231.508 ms 54.239.109.64 (54.239.109.64)  245.994 ms
17  54.239.109.191 (54.239.109.191)  224.999 ms 54.239.109.225 (54.239.109.225)  215.021 ms 54.239.109.91 (54.239.109.91)  215.129 ms
18  54.239.110.2 (54.239.110.2)  222.175 ms 54.239.109.84 (54.239.109.84)  246.168 ms 54.239.109.150 (54.239.109.150)  248.753 ms
19  54.239.111.87 (54.239.111.87)  224.176 ms 54.239.110.61 (54.239.110.61)  225.121 ms 54.239.109.181 (54.239.109.181)  224.877 ms
20  72.21.222.157 (72.21.222.157)  207.381 ms 205.251.245.236 (205.251.245.236)  215.617 ms  215.521 ms

traceroute 107.23.245.156
 1  10.254.0.1 (10.254.0.1)  0.255 ms  0.033 ms  0.024 ms
 2  192.168.0.1 (192.168.0.1)  2.662 ms  2.431 ms  2.405 ms
 3  10.5.0.1 (10.5.0.1)  2.480 ms  2.406 ms  2.548 ms
 4  219-81-19-233.static.tfn.net.tw (219.81.19.233)  2.688 ms  2.563 ms  2.595 ms
 5  60-199-18-141.static.tfn.net.tw (60.199.18.141)  2.552 ms  2.504 ms  2.714 ms
 6  60-199-20-58.static.tfn.net.tw (60.199.20.58)  2.732 ms 60-199-21-26.static.tfn.net.tw (60.199.21.26)  1.095 ms 60-199-23-13.static.tfn.net.tw (60.199.23.13)  1.127 ms
 7  60-199-3-222.static.tfn.net.tw (60.199.3.222)  1.232 ms  1.481 ms  1.416 ms
 8  63-218-244-173.static.pccwglobal.net (63.218.244.173)  1.931 ms persado.ge3-2.9.ar01.ath01.pccwbtn.net (63.218.17.101)  2.091 ms  1.998 ms
 9  * * *
10  * * *
11  * * *
12  * * *
13  54.240.228.232 (54.240.228.232)  225.426 ms 54.240.228.250 (54.240.228.250)  207.408 ms 54.240.228.244 (54.240.228.244)  225.496 ms
14  54.240.229.189 (54.240.229.189)  225.296 ms 54.240.229.191 (54.240.229.191)  211.032 ms 54.240.229.185 (54.240.229.185)  224.290 ms
15  54.240.228.173 (54.240.228.173)  223.694 ms 54.240.229.135 (54.240.229.135)  215.156 ms 54.240.228.171 (54.240.228.171)  224.759 ms
16  54.239.109.232 (54.239.109.232)  210.824 ms 54.239.109.100 (54.239.109.100)  216.596 ms 54.239.110.10 (54.239.110.10)  233.723 ms
17  54.239.109.157 (54.239.109.157)  223.345 ms 54.239.109.151 (54.239.109.151)  223.360 ms 54.239.110.5 (54.239.110.5)  206.261 ms
18  54.239.109.194 (54.239.109.194)  237.787 ms 54.239.109.254 (54.239.109.254)  210.293 ms 54.239.109.48 (54.239.109.48)  242.781 ms
19  54.239.111.103 (54.239.111.103)  225.468 ms 54.239.111.107 (54.239.111.107)  224.655 ms  225.515 ms
20  205.251.245.121 (205.251.245.121)  207.356 ms 205.251.244.229 (205.251.244.229)  228.140 ms 205.251.244.233 (205.251.244.233)  216.141 ms

traceroute 54.164.213.58
 1  10.254.0.1 (10.254.0.1)  0.096 ms  0.028 ms  0.013 ms
 2  192.168.0.1 (192.168.0.1)  1.728 ms  1.667 ms  1.626 ms
 3  10.5.0.1 (10.5.0.1)  1.650 ms  1.528 ms  1.514 ms
 4  219-81-19-233.static.tfn.net.tw (219.81.19.233)  1.951 ms  2.168 ms  1.860 ms
 5  60-199-18-141.static.tfn.net.tw (60.199.18.141)  1.645 ms  1.612 ms  1.756 ms
 6  60-199-20-222.static.tfn.net.tw (60.199.20.222)  2.003 ms 60-199-21-26.static.tfn.net.tw (60.199.21.26)  1.191 ms  1.136 ms
 7  60-199-3-222.static.tfn.net.tw (60.199.3.222)  1.246 ms  1.700 ms  1.850 ms
 8  63-218-244-173.static.pccwglobal.net (63.218.244.173)  2.436 ms 63-218-17-5.static.pccwglobal.net (63.218.17.5)  2.328 ms 63-218-244-173.static.pccwglobal.net (63.218.244.173)  2.321 ms
 9  * * *
10  * * *
11  * * *
12  * * *
13  54.240.228.238 (54.240.228.238)  224.784 ms 54.240.228.232 (54.240.228.232)  224.248 ms 54.240.228.244 (54.240.228.244)  224.916 ms
14  54.240.229.191 (54.240.229.191)  211.277 ms 54.240.229.189 (54.240.229.189)  226.121 ms 54.240.229.191 (54.240.229.191)  211.260 ms
15  54.240.228.177 (54.240.228.177)  224.722 ms 54.240.229.135 (54.240.229.135)  215.072 ms 54.240.228.173 (54.240.228.173)  223.442 ms
16  54.239.110.12 (54.239.110.12)  234.524 ms 54.239.109.128 (54.239.109.128)  236.637 ms 54.239.109.94 (54.239.109.94)  229.736 ms
17  54.239.109.121 (54.239.109.121)  228.841 ms 54.239.109.59 (54.239.109.59)  215.361 ms 54.239.109.85 (54.239.109.85)  221.902 ms
18  54.239.110.0 (54.239.110.0)  225.071 ms 54.239.109.192 (54.239.109.192)  234.307 ms 54.239.109.48 (54.239.109.48)  252.660 ms
19  54.239.111.89 (54.239.111.89)  224.270 ms 54.239.109.249 (54.239.109.249)  224.616 ms 54.239.111.85 (54.239.111.85)  223.968 ms
20  205.251.245.242 (205.251.245.242)  223.953 ms 72.21.222.157 (72.21.222.157)  209.025 ms 205.251.245.53 (205.251.245.53)  224.565 ms


https://docs.cloudfoundry.org/running/troubleshooting/troubleshooting-apps.html
http://docs.openstack.org/openstack-ops/content/network_troubleshooting.html

[HP-controller] > ip netns list # list all network namespace
[HP-controller] > ip netns exec qrouter-f734d62f-ea96-4095-aa9b-a120d0a6331d bash # enter router network namespace
